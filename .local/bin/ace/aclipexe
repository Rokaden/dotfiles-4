#!/bin/bash

[ -f /tmp/nulsel ] || touch /tmp/nulsel
procd=""

main(){
	while clipnotify; do
		sel=$(xclip -selection clipboard -o)
		if [ ! "$sel" ]; then
			main
		elif [ "$sel" == "$procd" ]; then
			main
		fi
		case "$sel" in
			*youtube.com/watch*) ytdl ;;
			*youtu.be/watch*) ytdl ;;
			*magnet*tracker*) trans ;;
			*twitch.tv/*) twsl ;;
			https://*.redd*/*) nbrdt ;;
			*) ignr ;;
		esac
	done
}

ytdl(){
	procd=$sel
	i3-msg -q 'exec --no-startup-id urxvtc -T HideMe -e youtube-dl $(xclip -selection clipboard -o)'
	dunstify -r 4088002 -t 3000 "downloading" "$(xclip -selection clipboard -o)" -i "~/.config/dunst/ytdl_sml.png"
	xclip -selection clipboard /tmp/nulsel
	main
}

trans(){
	procd=$sel
	i3-msg -q 'exec --no-startup-id transmission-remote -a $(xclip -selection clipboard -o)'
	dunstify -t 3000 "torrent added" -i "~/.config/dunst/transmission.svg"
	xclip -selection clipboard /tmp/nulsel
	main
}

twsl(){
	procd=$sel
	i3-msg -q 'exec --no-startup-id streamlink -p mpv $(xclip -selection clipboard -o) best'
	dunstify -t 3000 "loading stream" "$(xclip -selection clipboard -o)" -i "~/.config/dunst/twitch.svg"
	xclip -selection clipboard /tmp/nulsel
	main
}

nbrdt(){
	procd=$sel
	i3-msg -q 'exec --no-startup-id xdg-open $(xclip -selection clipboard -o)'
	xclip -selection clipboard /tmp/nulsel
	main
}

ignr(){
	procd=$sel
	main
}

main
