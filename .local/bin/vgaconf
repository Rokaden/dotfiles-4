#!/bin/bash

bbrep=$(cat /proc/acpi/bbswitch)
cmode=$(optimus-manager --print-mode)

stay(){
	dunstify -C 4088088
	exit
}

cintel(){
	dunstify -r 4088088 -t 10000 "vga config " "$cmode\n$bbrep" -i "/home/dave/.config/dunst/intel.svg"
	itgl=$(echo -e "stick\ntwist" | rofi -dmenu -format i)
	if [ "$itgl" = 0 ]; then
		stay
	elif [ "$itgl" = 1 ]; then
		optimus-manager --set-startup nvidia
		reboot
	fi
	return
}

cnvidia(){
	dunstify -r 4088088 -t 10000 "vga config " "$cmode\n$bbrep" -i "/home/dave/.config/dunst/nvidia.svg"
	ntgl=$(echo -e "stick\ntwist" | rofi -dmenu -format i)
	if [ "$ntgl" = 0 ]; then
		stay
	elif [ "$ntgl" = 1 ]; then
		optimus-manager --set-startup intel
		reboot
	fi
	return
}

case "$cmode" in
	*intel*) cintel ;;
	*nvidia*) cnvidia ;;
	*) return ;;
esac

stay
